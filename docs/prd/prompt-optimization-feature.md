# 提示词优化功能 PRD

## 文档信息

- **项目名称**: Prompt Manager - 提示词优化功能
- **文档版本**: v1.0
- **创建日期**: 2025-12-26
- **状态**: 待评审
- **负责人**: 产品团队

---

## 1. 项目概述

### 1.1 背景

Prompt Manager 是一个基于 MCP 协议的提示词管理服务，目前提供了完善的提示词创建、编辑、管理和测试功能。用户反馈希望在提示词编辑过程中增加 AI 辅助优化功能，以提升提示词质量和编写效率。

### 1.2 目标

在现有的提示词管理页面中集成 AI 提示词优化功能，帮助用户：
- 快速优化提示词质量
- 提升提示词的结构清晰度和指令明确性
- 增强提示词的角色扮演能力
- 提供优化前后的对比分析

### 1.3 参考方案

本功能设计参考了 [prompt-optimizer](https://github.com/linshenkx/prompt-optimizer) 工具的设计理念，包括：
- 双模式优化（系统提示词/用户提示词）
- 智能优化建议
- 对比测试能力
- 多轮迭代改进

---

## 2. 用户需求分析

### 2.1 目标用户

- **主要用户**: 提示词开发者、AI 应用开发者
- **次要用户**: 需要编写高质量提示词的产品经理、内容创作者

### 2.2 用户痛点

1. **编写困难**: 不知道如何写出高质量的提示词
2. **优化耗时**: 需要反复调整和测试才能达到理想效果
3. **缺乏标准**: 缺少专业的提示词优化方法和工具
4. **对比困难**: 优化前后难以直观对比效果

### 2.3 用户期望

- 在编辑页面直接使用优化功能，无需切换页面
- 能够看到优化前后的对比
- 可以根据需求选择不同的优化策略
- 优化建议可以手动调整和应用

---

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 优化入口

- **位置**: 编辑器顶部工具栏，"保存"按钮左侧
- **触发方式**: 点击"AI优化"按钮
- **状态反馈**: 优化过程中显示加载动画

#### 3.1.2 优化面板

采用侧边抽屉（Side Drawer）设计，从右侧滑出：

**面板内容：**

1. **优化模式选择**
   - 快速优化：基础的结构和语法优化
   - 深度优化：全面的角色、指令、输出格式优化
   - 迭代改进：基于用户反馈的持续优化

2. **原始提示词展示**
   - 只读编辑器显示当前提示词内容
   - 语法高亮
   - 自动滚动定位

3. **优化建议展示**
   - AI 生成的优化建议
   - 可编辑状态
   - 语法高亮

4. **优化分析**
   - 结构清晰度评分（1-5星）及提升百分比
   - 角色定位评分及提升百分比
   - 指令明确性评分及提升百分比
   - 详细的改进建议列表

5. **操作按钮**
   - 应用优化：将优化后的内容应用到主编辑器
   - 重新生成：获取不同的优化方案
   - 复制到剪贴板：复制优化结果

#### 3.1.3 配置管理

在优化面板右上角添加"⚙️设置"按钮，配置项包括：

1. **模型选择**
   - OpenAI GPT-4
   - OpenAI GPT-3.5
   - Google Gemini
   - 其他模型（可扩展）

2. **优化目标**
   - 提升准确性（勾选框）
   - 增强角色扮演（勾选框）
   - 优化指令清晰度（勾选框）
   - 改进输出格式（勾选框）

3. **优化强度**
   - 轻度：保持原意，微调表达
   - 中度：适度优化，平衡改动
   - 强度：大幅改进，追求极致

4. **API 配置**
   - API Key 输入框（加密存储）
   - 自定义 API 端点（可选）

### 3.2 扩展功能

#### 3.2.1 历史记录

- 保存每次优化的历史记录
- 支持查看和恢复历史版本
- 显示优化时间、模式、评分

#### 3.2.2 批量优化

- 支持选择多个提示词进行批量优化
- 显示批量优化进度和结果汇总

#### 3.2.3 优化模板

- 预设常用优化模板（如：代码生成、文案写作、数据分析等）
- 支持自定义优化模板

---

## 4. 交互设计

### 4.1 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ [返回] [名称输入] [分组选择] [编辑/预览] [AI优化] [保存]          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  左侧参数配置区          │  右侧编辑器区                         │
│  (可折叠)               │  [编辑器] [预览] [变量测试]           │
│                         │                                       │
│                         │  ┌─────────────────────────────────┐ │
│                         │  │                                 │ │
│                         │  │  主编辑器内容                    │ │
│                         │  │                                 │ │
│                         │  └─────────────────────────────────┘ │
│                         │                                       │
│                         │  ┌─────────────────────────────────┐ │
│                         │  │  🤖 AI 提示词优化        [×]     │ │
│                         │  ├─────────────────────────────────┤ │
│                         │  │  优化模式:                       │ │
│                         │  │  ○ 快速  ○ 深度  ○ 迭代         │ │
│                         │  │                                 │ │
│                         │  │  原始提示词:                     │ │
│                         │  │  [只读编辑器]                    │ │
│                         │  │                                 │ │
│                         │  │  优化建议:                       │ │
│                         │  │  [可编辑编辑器]                  │ │
│                         │  │                                 │ │
│                         │  │  📊 优化分析:                    │ │
│                         │  │  • 结构: ⭐⭐⭐⭐⭐ (↑40%)        │ │
│                         │  │  • 角色: ⭐⭐⭐⭐   (↑25%)        │ │
│                         │  │  • 指令: ⭐⭐⭐⭐⭐ (↑35%)        │ │
│                         │  │                                 │ │
│                         │  │  [应用优化] [重新生成] [复制]    │ │
│                         │  └─────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 交互流程

```
用户点击"AI优化"
    ↓
打开右侧抽屉面板（300ms 滑入动画）
    ↓
自动分析当前提示词（显示 loading 动画）
    ↓
显示优化建议和分析结果
    ↓
用户操作：
    ├─ 查看原始 vs 优化对比
    ├─ 编辑优化建议
    ├─ 点击"应用优化" → 替换主编辑器内容
    ├─ 点击"重新生成" → 获取新的优化方案
    └─ 点击"复制" → 复制到剪贴板
    ↓
关闭抽屉（可选）
```

### 4.3 视觉设计

#### 4.3.1 颜色方案

- **抽屉背景**: #ffffff (白色)
- **抽屉边框**: 1px solid #e0e0e0
- **优化建议高亮**: rgba(24, 144, 255, 0.1) (浅蓝色背景)
- **应用按钮**: #52c41a (绿色，表示正向操作)
- **重新生成按钮**: #1890ff (蓝色，表示中性操作)
- **关闭按钮**: #999999 (灰色)

#### 4.3.2 动画效果

- **抽屉滑入**: transform: translateX(100%) → translateX(0) (300ms ease-out)
- **抽屉滑出**: transform: translateX(0) → translateX(100%) (300ms ease-in)
- **加载动画**: 旋转的圆环或脉冲效果
- **优化建议渐显**: opacity: 0 → 1 (200ms ease-in)
- **评分动画**: 星星逐个点亮（100ms 间隔）

#### 4.3.3 响应式设计

- **桌面端**: 抽屉宽度 600px
- **平板端**: 抽屉宽度 80%
- **移动端**: 抽屉宽度 100%，从底部滑出

---

## 5. 技术方案

### 5.1 前端技术栈

- **框架**: 原生 JavaScript + CSS（与现有代码保持一致）
- **编辑器**: CodeMirror（复用现有实例）
- **动画**: CSS Transitions + Transforms
- **HTTP 请求**: Fetch API

### 5.2 后端技术栈

- **框架**: Express.js（与现有服务保持一致）
- **AI 集成**: OpenAI API / Google Gemini API
- **配置管理**: 环境变量 + 用户配置文件
- **日志**: 现有 logger 模块

### 5.3 数据存储

- **用户配置**: 存储在 `~/.prompt-manager/config.json`
- **优化历史**: 存储在 `~/.prompt-manager/optimization-history.json`
- **API Key**: 加密存储在配置文件中

### 5.4 安全性

- API Key 加密存储（使用 AES-256）
- API 请求使用 HTTPS
- 优化历史限制存储数量（最多保留 100 条）
- 敏感信息不记录到日志

---

## 6. API 设计

### 6.1 优化提示词

**端点**: `POST /api/prompts/optimize`

**请求体**:

```json
{
  "prompt": "原始提示词内容",
  "mode": "quick|deep|iterate",
  "options": {
    "model": "gpt-4",
    "goals": ["accuracy", "clarity", "role", "format"],
    "intensity": "light|medium|strong"
  }
}
```

**响应体**:

```json
{
  "success": true,
  "data": {
    "optimized": "优化后的提示词",
    "analysis": {
      "structure": {
        "score": 5,
        "improvement": 40
      },
      "role": {
        "score": 4,
        "improvement": 25
      },
      "clarity": {
        "score": 5,
        "improvement": 35
      }
    },
    "improvements": [
      "增加了角色定位",
      "优化了指令结构",
      "改进了输出格式"
    ],
    "mode": "deep",
    "model": "gpt-4"
  }
}
```

**错误响应**:

```json
{
  "success": false,
  "error": {
    "code": "API_KEY_MISSING",
    "message": "请先配置 API Key"
  }
}
```

### 6.2 获取优化配置

**端点**: `GET /api/optimization/config`

**响应体**:

```json
{
  "success": true,
  "data": {
    "model": "gpt-4",
    "goals": ["accuracy", "clarity"],
    "intensity": "medium",
    "apiKeyConfigured": true
  }
}
```

### 6.3 更新优化配置

**端点**: `PUT /api/optimization/config`

**请求体**:

```json
{
  "model": "gpt-4",
  "goals": ["accuracy", "clarity", "role"],
  "intensity": "strong",
  "apiKey": "sk-xxx"
}
```

**响应体**:

```json
{
  "success": true,
  "message": "配置已保存"
}
```

### 6.4 获取优化历史

**端点**: `GET /api/optimization/history?limit=20`

**响应体**:

```json
{
  "success": true,
  "data": {
    "total": 45,
    "items": [
      {
        "id": "opt_123456",
        "promptName": "代码审查提示词",
        "mode": "deep",
        "model": "gpt-4",
        "timestamp": "2025-12-26T10:30:00Z",
        "scores": {
          "structure": 5,
          "role": 4,
          "clarity": 5
        }
      }
    ]
  }
}
```

---

## 7. 实施计划

### 7.1 开发阶段

#### Phase 1: UI 框架开发（1-2 天）

**任务清单**:
- [ ] 创建抽屉组件 HTML/CSS
- [ ] 添加"AI优化"按钮到工具栏
- [ ] 实现抽屉打开/关闭动画
- [ ] 实现配置模态框 UI
- [ ] 实现加载动画和状态反馈

**交付物**:
- 完整的 UI 组件代码
- 样式文件
- 交互原型

#### Phase 2: 后端集成（2-3 天）

**任务清单**:
- [ ] 实现优化 API 端点
- [ ] 集成 OpenAI API
- [ ] 集成 Google Gemini API
- [ ] 实现配置管理功能
- [ ] 添加错误处理和日志记录

**交付物**:
- 后端 API 代码
- API 文档
- 单元测试

#### Phase 3: 功能完善（2-3 天）

**任务清单**:
- [ ] 实现三种优化模式
- [ ] 实现优化分析展示
- [ ] 实现应用/重新生成功能
- [ ] 实现配置保存和加载
- [ ] 实现历史记录功能

**交付物**:
- 完整的前后端集成代码
- 功能测试报告

#### Phase 4: 测试优化（1-2 天）

**任务清单**:
- [ ] 测试各种提示词场景
- [ ] 优化 AI 输出质量
- [ ] 性能优化
- [ ] 用户体验优化

**交付物**:
- 测试报告
- 性能优化报告
- 用户体验改进建议

### 7.2 里程碑

| 里程碑 | 时间点 | 交付内容 |
|--------|--------|----------|
| M1: UI 框架完成 | Day 2 | 可交互的 UI 原型 |
| M2: 后端集成完成 | Day 5 | 可用的优化 API |
| M3: 功能完整 | Day 8 | 完整的优化功能 |
| M4: 测试通过 | Day 10 | 可发布的功能版本 |

---

## 8. 验收标准

### 8.1 功能验收

- [ ] 用户可以通过点击"AI优化"按钮打开优化面板
- [ ] 优化面板支持三种优化模式
- [ ] 优化结果能够正确显示在面板中
- [ ] 用户可以编辑优化建议
- [ ] "应用优化"按钮能够正确替换主编辑器内容
- [ ] "重新生成"按钮能够生成新的优化方案
- [ ] 配置能够正确保存和加载
- [ ] 优化历史能够正确记录和查询

### 8.2 性能验收

- [ ] 优化请求响应时间 < 10 秒（GPT-4）
- [ ] 优化请求响应时间 < 5 秒（GPT-3.5）
- [ ] 抽屉打开/关闭动画流畅（60fps）
- [ ] 页面加载时间不受影响

### 8.3 兼容性验收

- [ ] 支持 Chrome 90+
- [ ] 支持 Firefox 88+
- [ ] 支持 Safari 14+
- [ ] 支持 Edge 90+

### 8.4 安全验收

- [ ] API Key 加密存储
- [ ] 敏感信息不记录到日志
- [ ] API 请求使用 HTTPS
- [ ] 优化历史限制存储数量

---

## 9. 风险评估

### 9.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| AI API 限流 | 高 | 中 | 实现请求队列和重试机制 |
| AI 输出质量不稳定 | 中 | 中 | 提供重新生成功能，优化 prompt |
| API Key 泄露 | 高 | 低 | 加密存储，定期轮换 |
| 性能问题 | 中 | 低 | 实现缓存机制，优化请求 |

### 9.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 用户不接受优化结果 | 中 | 中 | 提供多种优化模式，支持手动调整 |
| 功能过于复杂 | 低 | 中 | 提供默认配置，简化 UI |
| 成本过高 | 高 | 中 | 支持多种模型，提供成本预估 |

---

## 10. 后续规划

### 10.1 短期规划（1-3 个月）

- [ ] 支持更多 AI 模型（Claude、文心一言等）
- [ ] 实现批量优化功能
- [ ] 添加优化模板功能
- [ ] 优化历史记录管理

### 10.2 中期规划（3-6 个月）

- [ ] 实现智能推荐优化模式
- [ ] 添加 A/B 测试功能
- [ ] 支持自定义优化规则
- [ ] 提供优化效果统计

### 10.3 长期规划（6-12 个月）

- [ ] 构建优化知识库
- [ ] 实现社区优化模板共享
- [ ] 支持多语言优化
- [ ] 提供优化效果分析报告

---

## 11. 附录

### 11.1 参考资料

- [prompt-optimizer GitHub](https://github.com/linshenkx/prompt-optimizer)
- [OpenAI API 文档](https://platform.openai.com/docs)
- [Google Gemini API 文档](https://ai.google.dev/docs)

### 11.2 术语表

| 术语 | 说明 |
|------|------|
| 提示词优化 | 使用 AI 技术改进提示词质量的过程 |
| 侧边抽屉 | 从页面边缘滑出的面板，用于显示额外内容 |
| 快速优化 | 基础的结构和语法优化模式 |
| 深度优化 | 全面的角色、指令、输出格式优化模式 |
| 迭代改进 | 基于用户反馈的持续优化模式 |

### 11.3 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2025-12-26 | 初始版本 | 产品团队 |

---

**文档结束**