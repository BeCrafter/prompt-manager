<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Manager 后台</title>
  <link rel="stylesheet" href="./css/codemirror.css">
  <link rel="stylesheet" href="./css/codemirror-theme_xq-light.css">
</head>
<body>
  <!-- 登录界面 -->
  <div id="login" class="login-container" style="display: none;">
    <form id="loginForm" class="login-form">
      <div class="login-box">
        <h2>Prompt Manager</h2>
        <div class="input-group username">
          <input type="text" id="username" name="username" placeholder="用户名" autocomplete="username" />
        </div>
        <div class="input-group password">
          <input type="password" id="password" name="password" placeholder="密码" autocomplete="current-password" />
        </div>
        <button type="submit" id="loginBtn" class="btn btn-primary">登&nbsp;&nbsp;&nbsp;&nbsp;录</button>
        <div id="loginError" class="error-msg" style="display: none; margin-top: 15px;"></div>
      </div>
    </form>
  </div>

  <!-- 主界面 -->
      <!-- 类目管理弹窗 -->
    <div id="newFolderModal" class="modal hidden">
      <div class="modal-dialog">
        <div class="modal-content group-modal-content">
          <div class="modal-header">
            <h3>类目管理</h3>
            <button type="button" class="modal-close" onclick="toggleNewFolderModal()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div class="modal-body">
            <div class="group-modal-tabs">
              <button type="button" class="group-modal-tab active" data-tab="create">新增类目</button>
              <button type="button" class="group-modal-tab" data-tab="manage">管理类目</button>
            </div>
            <div class="group-modal-panel" data-panel="create">
              <div class="form-group">
                <label>目录名称</label>
                <input type="text" id="newFolderName" name="folderName" placeholder="请输入目录名称" onkeydown="handleNewFolderKeydown(event)">
                <div class="group-modal-hint">名称仅支持字母、数字、下划线、短横线和中文，长度不超过64个字符。</div>
              </div>
              <div class="form-group">
                <label>父级目录</label>
                <select id="newFolderParent" class="form-control">
                  <option value="">根目录</option>
                </select>
                <div class="group-modal-hint">选择父级目录以创建子目录</div>
              </div>
            </div>
            <div class="group-modal-panel hidden" data-panel="manage">
              <div class="group-manage-toolbar">
                <input type="text" id="groupManageSearch" placeholder="搜索类目..." />
                <button type="button" class="btn btn-light btn-sm" id="groupManageRefreshBtn">刷新</button>
              </div>
              <div class="group-manage-list" id="groupManageList"></div>
              <div class="group-manage-empty hidden" id="groupManageEmpty">暂无类目信息</div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="group-modal-footer group-modal-footer-create" id="groupModalCreateFooter">
              <button type="button" class="btn btn-light" onclick="toggleNewFolderModal()">取消</button>
              <button type="button" class="btn btn-dark" onclick="createNewFolder()">创建</button>
            </div>
            <div class="group-modal-footer group-modal-footer-manage hidden" id="groupModalManageFooter">
              <button type="button" class="btn btn-light" onclick="toggleNewFolderModal(false)">关闭</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div id="main" style="display: none; height: 100vh; flex-direction: column;">
    <!-- 顶部导航 -->
    <header>
      <div class="logo">
        Prompt Manager <span>Beta</span>
      </div>
      <div class="nav-right">
        <div class="user-profile">
          <button class="avatar-btn" id="avatarBtn" aria-haspopup="true" aria-expanded="false">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239ca3af'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z'/%3E%3C/svg%3E" alt="用户头像" class="avatar-img">
          </button>
          <div class="dropdown-menu" id="userMenu">
            <div class="dropdown-header">
              <div class="user-info">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239ca3af'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z'/%3E%3C/svg%3E" alt="用户头像" class="user-avatar">
                <div class="user-details">
                  <div class="user-name">管理员</div>
                  <div class="user-role">Admin</div>
                </div>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <button id="logoutBtn" class="dropdown-item">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-icon"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
              退出登录
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- 主体内容 -->
    <main>
      <!-- 左侧边栏 -->
      <aside>
        <div class="sidebar-header">
          <button id="newPromptBtn" class="new-prompt-btn">
            新建 Prompt
          </button>
          <div class="search-container">
            <div class="search-box">
              <input type="text" id="searchInput" name="searchInput" placeholder="搜索提示词..." autocomplete="off" />
              <button type="button" class="clear-btn" title="清除搜索"></button>
            </div>
            <button id="newGroupBtn" class="folder-btn" title="新建目录">
            </button>
          </div>
        </div>
        
        <div id="groupList"></div>
      </aside>

      <!-- 右侧编辑器 -->
      <div class="editor-container">
        <!-- 自定义空白内容区域 -->
        <div class="custom-blank-content" id="customBlankContent" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: #9ca3af; font-size: 16px;">
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">📝</div>
            <p>请选择左侧的 Prompt 或点击"新建 Prompt"开始编辑</p>
          </div>
        </div>
        
        <!-- Prompt 编辑区域（默认隐藏） -->
        <div id="promptEditorArea" style="display: none; flex-direction: column; height: 100%;">
          <div class="editor-header">
            <div class="editor-header-top">
              <input type="text" id="promptName" name="promptName" placeholder="Prompt 名称" />
              <div class="group-selector">
                <button type="button" id="promptGroupBtn" class="group-selector-btn" aria-haspopup="listbox" aria-expanded="false" aria-controls="promptGroupDropdown">
                  <span class="group-selector-label" style="display: none;">关联类目</span>
                  <span class="group-selector-value" id="promptGroupLabel">default</span>
                  <span class="group-selector-icon" aria-hidden="true">
                    <svg width="14" height="14" viewBox="0 0 20 20" fill="none">
                      <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                </button>
                <select id="promptGroup" class="group-selector-input" aria-hidden="true" tabindex="-1">
                  <!-- 选项将通过后端接口动态加载 -->
                </select>
                <div class="group-dropdown" id="promptGroupDropdown" role="dialog" aria-modal="false">
                  <div class="group-dropdown-search">
                    <input type="text" id="promptGroupSearch" placeholder="搜索类目..." autocomplete="off" />
                  </div>
                  <div class="group-dropdown-body">
                    <div class="group-cascader" id="promptGroupCascader"></div>
                    <div class="group-search-results" id="promptGroupSearchResults"></div>
                    <div class="group-dropdown-empty hidden" id="promptGroupEmpty">暂无匹配的类目</div>
                  </div>
                </div>
              </div>
              <div class="editor-controls">
                <div class="mode-toggle">
                  <button id="editModeBtn" class="mode-btn active" data-mode="edit">编辑</button>
                  <button id="previewModeBtn" class="mode-btn" data-mode="preview">预览</button>
                </div>
                <button id="saveBtn" class="btn btn-primary btn-sm">
                  保存
                </button>
              </div>
            </div>
            <textarea id="promptDescription" class="prompt-description" placeholder="Prompt 描述"></textarea>
          </div>

          <div class="editor-content">
            <section class="arguments-section" id="argumentsSection">
              <div class="arguments-header">
                <div class="arguments-title">
                  <span>参数配置</span>
                </div>
                <div class="arguments-actions">
                  <button id="addArgumentBtn" class="btn btn-outline btn-sm" type="button">
                    新增
                  </button>
                </div>
              </div>
              <div class="arguments-list" id="argumentsList">
                <div class="arguments-empty">暂无参数，点击"新增"开始配置</div>
              </div>
            </section>
            <div class="editor-body" id="editorWorkspace">
              <div class="workspace-pane" id="editorPane">
                <div class="pane-header">编辑器</div>
                <div class="pane-content">
                  <textarea id="editor"></textarea>
                </div>
              </div>
              <div class="workspace-pane hidden" id="previewPane">
                <div class="pane-header">实时预览</div>
                <div class="pane-content preview">
                  <div class="preview-content" id="previewContent">
                    <p>选择或创建prompt开始编辑</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 消息提示 -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- 删除 Prompt 弹窗 -->
  <div id="deletePromptModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="deletePromptTitle">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="deletePromptTitle">删除 Prompt</h3>
          <button type="button" class="modal-close" id="deletePromptCloseBtn" aria-label="关闭">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p style="font-size: 14px; color: var(--gray); line-height: 1.6;">
            确认删除 <span id="deletePromptName" style="color: var(--dark); font-weight: 600;"></span> 吗？该操作不可撤销。
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" id="deletePromptCancelBtn">取消</button>
          <button type="button" class="btn btn-danger" id="deletePromptConfirmBtn">删除</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 参数编辑弹窗 -->
  <div id="argumentModal" class="argument-modal hidden" role="dialog" aria-modal="true" aria-labelledby="argumentModalTitle">
    <div class="argument-modal-dialog">
      <div class="argument-modal-header">
        <h3 id="argumentModalTitle">新增参数</h3>
        <button type="button" id="argumentModalClose" class="argument-modal-close" aria-label="关闭">×</button>
      </div>
      <form id="argumentForm" class="argument-modal-form">
        <div class="argument-modal-body">
          <div class="argument-form-grid">
            <div class="form-field">
              <label for="argumentNameInput">参数名称 <span class="required">*</span></label>
              <input type="text" id="argumentNameInput" name="argumentName" placeholder="例如：language" />
            </div>
            <div class="form-field">
              <label for="argumentTypeInput">类型</label>
              <input type="text" id="argumentTypeInput" name="argumentType" list="argumentTypeOptions" placeholder="例如：string" />
            </div>
            <div class="form-field">
              <label for="argumentDefaultInput">默认值</label>
              <input type="text" id="argumentDefaultInput" name="argumentDefault" placeholder="可选" />
            </div>
            <div class="form-field form-field-inline">
              <label class="checkbox-field">
                <input type="checkbox" id="argumentRequiredInput" />
                <span>必填</span>
              </label>
            </div>
            <div class="form-field full-width">
              <label for="argumentDescriptionInput">参数说明</label>
              <textarea id="argumentDescriptionInput" rows="3" placeholder="用于提示词中的描述"></textarea>
            </div>
          </div>
        </div>
        <div class="argument-modal-footer">
          <button type="button" class="btn btn-outline" id="argumentCancelBtn">取消</button>
          <button type="submit" class="btn btn-primary">保存</button>
        </div>
      </form>
    </div>
  </div>

  <datalist id="argumentTypeOptions">
    <option value="string">字符串</option>
    <option value="number">数字</option>
    <option value="boolean">布尔值</option>
  </datalist>
</body>
</html>